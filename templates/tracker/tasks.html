{# change the for loop to iterate over the statuses context variable #}
{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-semibold mb-4">Tasks</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  {% for status_label, status_key in statuses %}
    <div class="p-3 bg-white dark:bg-slate-800 rounded">
      <div class="flex items-center justify-between mb-3">
        <h3 class="font-medium">{{ status_label }}</h3>
        <form method="post" class="inline">{% csrf_token %}
          <input type="hidden" name="action" value="create">
          <input type="hidden" name="status" value="{{ status_key }}">
          <button class="text-sky-500 text-sm">+ Add</button>
        </form>
      </div>

      {% for t in tasks %}
        {% if t.status == status_key %}
          <div class="p-3 mb-2 bg-slate-50 dark:bg-slate-900 rounded">
            <div class="flex justify-between items-start">
              <div>
                <div class="font-medium">{{ t.title }}</div>
                <div class="text-xs text-slate-500">{{ t.due_date }}</div>
              </div>
              <div class="flex flex-col gap-2">
                <form method="post" class="inline">{% csrf_token %}
                  <input type="hidden" name="action" value="move">
                  <input type="hidden" name="task_id" value="{{ t.pk }}">
                  {% if t.status != 'backlog' %}
                    <input type="hidden" name="status" value="backlog">
                    <button class="px-2 py-1 bg-slate-100 rounded text-xs">◀</button>
                  {% endif %}
                </form>
                <form method="post" class="inline">{% csrf_token %}
                  <input type="hidden" name="action" value="move">
                  <input type="hidden" name="task_id" value="{{ t.pk }}">
                  {% if t.status != 'done' %}
                    <input type="hidden" name="status" value="done">
                    <button class="px-2 py-1 bg-slate-100 rounded text-xs">▶</button>
                  {% endif %}
                </form>
              </div>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endfor %}
</div>
{% endblock %}